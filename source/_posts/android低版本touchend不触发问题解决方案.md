---
title: android低版本touchend不触发问题解决方案
date: 2016-12-09 11:19:21
tags: javascript
categories: 技术
---
> 上帝不会让你一直处于当前的深渊，他肯定把你拉出来，然后扔进另一个。

将近一个月的牙痛感觉基本平息了，万万没想到身上又起了疹，仔细看了之前吃牙痛的两种药，结果惊人的发现两种药都会引起皮疹和荨麻疹之类的不良反应，那一刻，我只想说："%E7%9C%9F%E6%98%AF%E5%93%94%E4%BA%86%E7%8B%97%E4%BA%86"。病了之后，才觉得无病的日子真的好好，虽然没有太多绚烂色调，但是平平常常也是很不错。这些天病了，也稍微空闲了一点，在一些群里帮助比我还白的小白的解答问题的时候，有人问了一个关于touch事件中touchend不触发的问题。由于之前遇到过，很快给他说了解决方法，但是这个问题让我记起了之前做个**积分夺宝**（大厂子都是一元夺宝）功能时留下的一个至今没解决的一个bug，那是我挥之不去阴影（让我静静的装会b）。下面就这个来说说这个bug详细情况。

几个月前，做个积分夺宝功能，当时去下了某厂子的夺宝app，体验了一番（这又是一段我挥之不去的阴影），请注意"体验"二字，半个月的饭就这样体验没了。功能做完测试的过程中，测试说有个页面滑动切换tab时切不过去。页面如图（测试版）<!--more-->
![](1.png)
最终神奇的发现这个bug只在Android4.0到4.4之间的几个版本不行，2.X的版本竟然都可以正常工作，这让人有点想不通，经过测试发现，之所以左右滑动切换不了是因为touch的三步中，最后一步touchend没触发。查阅资料后，发现在之前版本滑动过程中，如果不足之处浏览器默认行为，都会导致touchend不触发（这显然是系统bug），解决办法都是滑动过程中阻止浏览器默认行为，代码如下：

    //假设parentTarget是绑定事件的元素
    parentTarget.addEventListener('touchmove',function(e) {    
        e.preventDefault();    
    })

然后当时立刻试了下，可以切屏了，但是此时列表不能上下滑动了，相比不能切屏，不能上下滑问题更大，在几次实验无果之后，当时就暂时忽略了这个bug，由于在tab按钮上做了点击切屏，所以问题也不大。然后就一直到前些天，看到一篇文章时，里面提到有个方法感觉茅塞顿开，处理思路是，当我们在一个窗口中，既想横向滑动触发滑动效果，又想保留上下滚动时，我们可以给当前滑动操作一个临界值，如果当前横向滑动的距离超过这个临界值，则认为此次手指行为是拖拽行为，不属于滚动页面行为，所以应当将浏览器默认行为组织掉，如果小于，则按照浏览器自己默认行为走。代码如下：

    //假设parentTarget是绑定事件的元素,起始位置为横向位置为startx
    parentTarget.addEventListener('touchmove',function(e) {
       var move_x = e.touches[0].pageX;
       if((Math.abs(move_x-startx)>8)){
           e.preventDefault();
       }
    })
    
当然，上面也可换个思路应用于纵向拖动，横向滚动。总结一下就是一个方向拖动，同时保证另一个方向滚动的操作，都可以按照上面的方式解决。